<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="utf-8" />
    <title>SpecWriter Guide MVP</title>
    <style>
      :root {
        color-scheme: light;
        font-family: "Inter", "Apple SD Gothic Neo", sans-serif;
        font-size: 12px;
      }
      body {
        margin: 0;
        padding: 0;
        background: #fff;
        color: #1f1f1f;
      }
      header {
        padding: 12px 16px;
        border-bottom: 1px solid #ededed;
      }
      h1 {
        margin: 0;
        font-size: 14px;
        font-weight: 600;
      }
      .section {
        padding: 12px 16px;
      }
      .tabs {
        display: flex;
        border-bottom: 1px solid #ededed;
      }
      .tab {
        flex: 1;
        padding: 10px 12px;
        text-align: center;
        cursor: pointer;
        font-weight: 500;
      }
      .tab.active {
        color: #ffffff;
        background: #1f1f1f;
      }
      .panel {
        padding: 12px 16px;
        overflow: auto;
        height: 280px;
        background: #f7f7f7;
        border-bottom: 1px solid #e0e0e0;
      }
      pre {
        margin: 0;
        white-space: pre-wrap;
        word-break: break-word;
        line-height: 1.6;
      }
      textarea {
        width: 100%;
        min-height: 80px;
        padding: 8px;
        resize: vertical;
        font-size: 12px;
      }
      button {
        appearance: none;
        border: none;
        background: #1f1f1f;
        color: #ffffff;
        padding: 8px 12px;
        font-size: 12px;
        border-radius: 4px;
        cursor: pointer;
      }
      button[disabled] {
        opacity: 0.4;
        cursor: not-allowed;
      }
      .actions {
        display: flex;
        gap: 8px;
        padding: 12px 16px;
        justify-content: flex-start;
        align-items: center;
      }
      .input-group {
        padding: 12px 16px 0;
        display: flex;
        flex-direction: column;
        gap: 4px;
      }
      .manual-notes {
        padding: 12px 16px;
        display: flex;
        flex-direction: column;
        gap: 12px;
      }
      .manual-helper {
        font-size: 10px;
        color: #777;
      }
      .manual-notes textarea {
        min-height: 220px;
      }
      .manual-notes select {
        border: 1px solid #ccc;
        border-radius: 4px;
        padding: 6px 8px;
        font-size: 12px;
      }
      .classification-group {
        display: grid;
        grid-template-columns: repeat(2, minmax(0, 1fr));
        gap: 12px;
      }
      .classification-field {
        display: flex;
        flex-direction: column;
        gap: 4px;
      }
      .advanced-notes {
        border: 1px solid #e0e0e0;
        border-radius: 6px;
        padding: 8px 12px;
        background: #fafafa;
      }
      .advanced-notes summary {
        font-size: 12px;
        font-weight: 600;
        cursor: pointer;
        outline: none;
      }
      .advanced-grid {
        margin-top: 8px;
        display: grid;
        grid-template-columns: repeat(2, minmax(0, 1fr));
        gap: 12px;
      }
      .advanced-grid textarea {
        min-height: 100px;
      }
      .manual-note {
        display: flex;
        flex-direction: column;
        gap: 4px;
      }
      label {
        font-size: 11px;
        color: #555;
      }
      input {
        border: 1px solid #ccc;
        padding: 6px 8px;
        border-radius: 4px;
        font-size: 12px;
      }
      .status {
        padding: 0 16px 12px;
        font-size: 11px;
        color: #666;
        min-height: 28px;
        display: flex;
        align-items: center;
      }
      .status.error {
        color: #c62828;
      }
      .status.success {
        color: #2e7d32;
      }
      .badge {
        display: inline-block;
        padding: 2px 6px;
        background: #eee;
        border-radius: 4px;
        font-size: 10px;
        margin-left: 8px;
      }
      .toolbar {
        display: flex;
        justify-content: space-between;
        align-items: center;
        gap: 8px;
      }
      .copy {
        background: #0066ff;
      }
    </style>
  </head>
  <body>
    <header>
      <div class="toolbar">
        <div>
          <h1>
            SpecWriter Guide
            <span id="variantCount" class="badge" hidden>variants</span>
          </h1>
          <div id="componentName" style="font-size: 11px; color: #666;"></div>
        </div>
        <button id="refreshButton" style="background:#4f4f4f;">ìƒˆë¡œê³ ì¹¨</button>
      </div>
    </header>

    <div class="tabs">
      <div class="tab active" data-tab="data">ë°ì´í„°</div>
      <div class="tab" data-tab="guide">ê°€ì´ë“œ</div>
    </div>

    <div class="panel" id="panel">
      <pre id="panelContent">ì„ íƒëœ ì»´í¬ë„ŒíŠ¸ê°€ ì—†ìŠµë‹ˆë‹¤.</pre>
    </div>

    <div class="input-group">
      <label for="apiKey">OpenAI API Key</label>
      <input
        type="password"
        id="apiKey"
        placeholder="sk-..."
        autocomplete="off"
      />
    </div>

    <div class="manual-notes">
      <div class="classification-group">
        <div class="classification-field">
          <label for="componentType">ì»´í¬ë„ŒíŠ¸ íƒ€ì…</label>
          <select id="componentType">
            <option value="interactive">Interactive</option>
            <option value="composite" selected>Composite</option>
            <option value="layout">Layout</option>
            <option value="display">Display</option>
            <option value="form">Form</option>
          </select>
        </div>
        <div class="classification-field">
          <label for="complexity">ë³µì¡ë„</label>
          <select id="complexity">
            <option value="simple">Simple</option>
            <option value="medium" selected>Medium</option>
            <option value="complex">Complex</option>
          </select>
        </div>
      </div>

      <label for="policyNotes">ì»´í¬ë„ŒíŠ¸ ì •ì±… ë©”ëª¨</label>
      <textarea
        id="policyNotes"
        placeholder="# ğŸ§© Accordion ì»´í¬ë„ŒíŠ¸ ë””ìì¸ ì •ì±…&#10;&#10;## 1. ..."
      ></textarea>
      <div class="manual-helper">
        ì„¹ì…˜ ì œëª©ì´ë‚˜ í‚¤ì›Œë“œë¥¼ í¬í•¨í•´ ë¶™ì—¬ë„£ìœ¼ë©´ AIê°€ ê° ì„¹ì…˜ì— ë§ì¶° ë¶„ë¥˜í•©ë‹ˆë‹¤.
      </div>

      <details class="advanced-notes">
        <summary>ê³ ê¸‰ ì„¤ì • ë° ì„¹ì…˜ë³„ ë©”ëª¨ (ì„ íƒ)</summary>
        <div class="advanced-grid">
          <div class="manual-note">
            <label for="anatomyNotes">êµ¬ì¡° / Anatomy</label>
            <textarea id="anatomyNotes" placeholder="ì˜ˆ) í•„ìˆ˜ íŒŒíŠ¸, ì„ íƒ íŒŒíŠ¸, ê³„ì¸µ êµ¬ì¡°"></textarea>
          </div>
          <div class="manual-note">
            <label for="variantNotes">ë³€í˜• / Variants</label>
            <textarea id="variantNotes" placeholder="ì˜ˆ) í¬ê¸°, í…Œë§ˆ, ìƒíƒœ ë³„ ì¡°í•©"></textarea>
          </div>
          <div class="manual-note">
            <label for="stateNotes">ìƒíƒœ / States</label>
            <textarea id="stateNotes" placeholder="ì˜ˆ) Default, Hover, Active, Disabled..."></textarea>
          </div>
          <div class="manual-note">
            <label for="typographyNotes">íƒ€ì´í¬ê·¸ë˜í”¼ & ìƒ‰ìƒ</label>
            <textarea id="typographyNotes" placeholder="ì˜ˆ) Title=subtitle3, Description=captionM, ìƒ‰ìƒ í† í°"></textarea>
          </div>
          <div class="manual-note">
            <label for="layoutNotes">ê°„ê²© & ë ˆì´ì•„ì›ƒ</label>
            <textarea id="layoutNotes" placeholder="ì˜ˆ) Auto-layout, padding, spacing ê·œì¹™"></textarea>
          </div>
          <div class="manual-note">
            <label for="interactionNotes">ì¸í„°ë™ì…˜ & ì• ë‹ˆë©”ì´ì…˜</label>
            <textarea id="interactionNotes" placeholder="ì˜ˆ) íŠ¸ë¦¬ê±°, ì• ë‹ˆë©”ì´ì…˜ ì‹œê°„/easing"></textarea>
          </div>
          <div class="manual-note">
            <label for="responsiveNotes">ë°˜ì‘í˜•</label>
            <textarea id="responsiveNotes" placeholder="ì˜ˆ) ë¸Œë ˆì´í¬í¬ì¸íŠ¸, ì¤„ë°”ê¿ˆ ìœ í˜•"></textarea>
          </div>
          <div class="manual-note">
            <label for="accessibilityNotes">ì ‘ê·¼ì„±</label>
            <textarea id="accessibilityNotes" placeholder="ì˜ˆ) ARIA, í‚¤ë³´ë“œ, í¬ì»¤ìŠ¤ ê·œì¹™"></textarea>
          </div>
          <div class="manual-note">
            <label for="usageNotes">ì‚¬ìš© ê°€ì´ë“œ</label>
            <textarea id="usageNotes" placeholder="ì˜ˆ) ì¶”ì²œ/ê¸ˆì§€ ì‚¬ë¡€, ì‹œë‚˜ë¦¬ì˜¤"></textarea>
          </div>
          <div class="manual-note">
            <label for="customizationNotes">ì»¤ìŠ¤í…€ ì˜µì…˜</label>
            <textarea id="customizationNotes" placeholder="ì˜ˆ) styleOverrides ê°€ëŠ¥í•œ í•­ëª©"></textarea>
          </div>
          <div class="manual-note">
            <label for="constraintsNotes">ì œì•½ & ì œí•œ</label>
            <textarea id="constraintsNotes" placeholder="ì˜ˆ) ì‚¬ìš© ë¶ˆê°€ ì¼€ì´ìŠ¤, ìµœëŒ€ ì¤‘ì²© ìˆ˜ ë“±"></textarea>
          </div>
          <div class="manual-note">
            <label for="referencesNotes">ì—°ê´€ ì»´í¬ë„ŒíŠ¸ / ì°¸ê³ </label>
            <textarea id="referencesNotes" placeholder="ì˜ˆ) ê´€ë ¨ ì»´í¬ë„ŒíŠ¸, ë¬¸ì„œ ë§í¬"></textarea>
          </div>
          <div class="manual-note">
            <label for="useCasesNotes">ì‚¬ìš© ì‹œë‚˜ë¦¬ì˜¤</label>
            <textarea id="useCasesNotes" placeholder="ì˜ˆ) FAQ, ì„¤ì • í™”ë©´ ë“± ì‹œë‚˜ë¦¬ì˜¤ë³„ ê¶Œì¥ ì‚¬í•­"></textarea>
          </div>
        </div>
      </details>
    </div>

    <div class="actions">
      <button id="generateButton">AI ê°€ì´ë“œ ìƒì„±</button>
      <button id="copyButton" class="copy" disabled>ë³µì‚¬</button>
    </div>

    <div class="status" id="status">ì»´í¬ë„ŒíŠ¸ë¥¼ ì„ íƒí•˜ë©´ ìë™ìœ¼ë¡œ ë°ì´í„°ê°€ í‘œì‹œë©ë‹ˆë‹¤.</div>

    <script>
      const tabs = document.querySelectorAll(".tab");
      const panelContent = document.getElementById("panelContent");
      const panel = document.getElementById("panel");
      const statusEl = document.getElementById("status");
      const componentNameEl = document.getElementById("componentName");
      const variantCountEl = document.getElementById("variantCount");
      const refreshButton = document.getElementById("refreshButton");
      const generateButton = document.getElementById("generateButton");
      const copyButton = document.getElementById("copyButton");
      const apiKeyInput = document.getElementById("apiKey");
      const policyNotesInput = document.getElementById("policyNotes");
      const componentTypeSelect = document.getElementById("componentType");
      const complexitySelect = document.getElementById("complexity");
      const anatomyNotesInput = document.getElementById("anatomyNotes");
      const variantNotesInput = document.getElementById("variantNotes");
      const stateNotesInput = document.getElementById("stateNotes");
      const typographyNotesInput = document.getElementById("typographyNotes");
      const layoutNotesInput = document.getElementById("layoutNotes");
      const interactionNotesInput = document.getElementById("interactionNotes");
      const responsiveNotesInput = document.getElementById("responsiveNotes");
      const accessibilityNotesInput = document.getElementById("accessibilityNotes");
      const usageNotesInput = document.getElementById("usageNotes");
      const customizationNotesInput = document.getElementById("customizationNotes");
      const constraintsNotesInput = document.getElementById("constraintsNotes");
      const referencesNotesInput = document.getElementById("referencesNotes");
      const useCasesNotesInput = document.getElementById("useCasesNotes");

      let activeTab = "data";
      let metadata = null;
      let guideOutput = "";

      function setStatus(message, type = "info") {
        statusEl.textContent = message;
        statusEl.classList.remove("error", "success");
        if (type === "error") {
          statusEl.classList.add("error");
        } else if (type === "success") {
          statusEl.classList.add("success");
        }
      }

      function render() {
        if (activeTab === "data") {
          panelContent.textContent = metadata
            ? JSON.stringify(metadata, null, 2)
            : "ì„ íƒëœ ì»´í¬ë„ŒíŠ¸ê°€ ì—†ìŠµë‹ˆë‹¤.";
        } else {
          panelContent.textContent = guideOutput || "ì•„ì§ ìƒì„±ëœ ê°€ì´ë“œê°€ ì—†ìŠµë‹ˆë‹¤.";
        }
      }

      function updateHeader(data) {
        if (!data) {
          componentNameEl.textContent = "";
          variantCountEl.hidden = true;
          return;
        }
        componentNameEl.textContent = data.name;
        if (Array.isArray(data.variants) && data.variants.length > 0) {
          variantCountEl.hidden = false;
          variantCountEl.textContent = `${data.variants.length} variants`;
        } else {
          variantCountEl.hidden = true;
        }
      }

      tabs.forEach((tab) => {
        tab.addEventListener("click", () => {
          tabs.forEach((t) => t.classList.remove("active"));
          tab.classList.add("active");
          activeTab = tab.dataset.tab;
          render();
        });
      });

      refreshButton.addEventListener("click", () => {
        parent.postMessage({ pluginMessage: { type: "request-metadata" } }, "*");
        setStatus("ë°ì´í„°ë¥¼ ìƒˆë¡œê³ ì¹¨í•˜ëŠ” ì¤‘ì…ë‹ˆë‹¤...");
      });

      function requestCopy(text) {
        parent.postMessage(
          { pluginMessage: { type: "copy-guide", payload: text } },
          "*"
        );
        setStatus("ë³µì‚¬ë¥¼ ìš”ì²­í–ˆìŠµë‹ˆë‹¤...");
      }

      copyButton.addEventListener("click", () => {
        if (!guideOutput) return;
        requestCopy(guideOutput);
      });


      function valueOf(input) {
        if (!input || typeof input.value !== "string") {
          return "";
        }
        return input.value.trim();
      }

      function collectManualInputs() {
        return {
          rawPolicy: valueOf(policyNotesInput),
          componentType: valueOf(componentTypeSelect) || "composite",
          complexity: valueOf(complexitySelect) || "medium",
          structuredNotes: {
            anatomy: valueOf(anatomyNotesInput),
            variants: valueOf(variantNotesInput),
            states: valueOf(stateNotesInput),
            typography: valueOf(typographyNotesInput),
            layout: valueOf(layoutNotesInput),
            interactions: valueOf(interactionNotesInput),
            responsive: valueOf(responsiveNotesInput),
            accessibility: valueOf(accessibilityNotesInput),
            usage: valueOf(usageNotesInput),
            customization: valueOf(customizationNotesInput),
            constraints: valueOf(constraintsNotesInput),
            references: valueOf(referencesNotesInput),
            useCases: valueOf(useCasesNotesInput)
          }
        };
      }

      function typeGuidance(componentType) {
        const guidanceMap = {
          interactive: [
            "- ìƒí˜¸ì‘ìš© ìƒíƒœ(Default, Hover, Active, Disabled)ë¥¼ ë¹„êµ í‘œë¡œ ì •ë¦¬í•œë‹¤.",
            "- í´ë¦­/í„°ì¹˜/í‚¤ë³´ë“œ ì…ë ¥ì— ëŒ€í•œ í”¼ë“œë°±ê³¼ ì• ë‹ˆë©”ì´ì…˜ì„ ëª…ì‹œí•œë‹¤.",
            "- í¬ì»¤ìŠ¤ ìŠ¤íƒ€ì¼ê³¼ ì ‘ê·¼ì„± ê·œì¹™ì„ ë°˜ë“œì‹œ í¬í•¨í•œë‹¤."
          ],
          composite: [
            "- í•˜ìœ„ ì»´í¬ë„ŒíŠ¸ ê°„ ê´€ê³„ì™€ ì¡°í•© íŒ¨í„´ì„ ë‹¤ì´ì–´ê·¸ë¨ìœ¼ë¡œ ì„¤ëª…í•œë‹¤.",
            "- ê° ì„¹ì…˜ì´ ì–´ë–¤ ë°ì´í„°ë¥¼ í‘œì‹œí•˜ëŠ”ì§€ ëª…í™•íˆ ì •ì˜í•œë‹¤.",
            "- ìƒíƒœ ë³€í™” íë¦„(ì—´ë¦¼/ë‹«í˜, í™œì„±/ë¹„í™œì„±)ì„ ë‹¨ê³„ë³„ë¡œ ì •ë¦¬í•œë‹¤."
          ],
          layout: [
            "- spacing, alignment, breakpointsë¥¼ ìˆ˜ì¹˜ì™€ í•¨ê»˜ ì„¤ëª…í•œë‹¤.",
            "- í—ˆìš©ë˜ëŠ” ì¤‘ì²© êµ¬ì¡°ì™€ ì œì•½ì„ í‘œë¡œ ì •ë¦¬í•œë‹¤.",
            "- ë°˜ì‘í˜• ë™ì‘ê³¼ ì½˜í…ì¸  ì ì‘ ë°©ì‹ì„ ì˜ˆì‹œë¡œ ì œì‹œí•œë‹¤."
          ],
          display: [
            "- í¬ê¸° ì˜µì…˜, ì»¬ëŸ¬ í† í°, íƒ€ì´í¬ê·¸ë˜í”¼ ì¡°í•©ì„ í‘œë¡œ ì œì‹œí•œë‹¤.",
            "- ì •ë³´ ìœ„ê³„ì™€ ìƒíƒœ(ì •ë³´ ì—†ìŒ, ê²½ê³  ë“±)ë¥¼ êµ¬ë¶„í•´ ì„¤ëª…í•œë‹¤.",
            "- ì´ë¯¸ì§€/ì•„ì´ì½˜ ë“± ë¹„ì£¼ì–¼ ìš”ì†Œ ê·œì¹™ì„ í¬í•¨í•œë‹¤."
          ],
          form: [
            "- ë¼ë²¨, ë„ì›€ë§, ì—ëŸ¬ ë©”ì‹œì§€ êµ¬ì¡°ë¥¼ ì •ì˜í•œë‹¤.",
            "- ê²€ì¦ ê·œì¹™ê³¼ ìƒíƒœë³„ í”¼ë“œë°±(UI/í…ìŠ¤íŠ¸)ì„ ì„¤ëª…í•œë‹¤.",
            "- ì ‘ê·¼ì„± ìš”êµ¬ì‚¬í•­(í•„ìˆ˜/ì„ íƒ, í‚¤ë³´ë“œ, ìŠ¤í¬ë¦°ë¦¬ë”)ì„ í¬í•¨í•œë‹¤."
          ]
        };

        const list = guidanceMap[componentType] || [];
        if (list.length === 0) {
          return "(ì •ë³´ ì—†ìŒ)";
        }
        return list.join("\n");
      }

      function buildPrompt(metadata, manualInputs) {
        const manualJson = {
          componentType: manualInputs.componentType,
          complexity: manualInputs.complexity,
          structuredNotes: manualInputs.structuredNotes
        };

        const typeSpecificGuidance = typeGuidance(manualInputs.componentType);

        return `Context:
- ì œí’ˆ: SpecWriter ë””ìì¸ ì‹œìŠ¤í…œ
- ì‘ì„±ì: ë””ìì¸ ì‹œìŠ¤í…œ ë””ìì´ë„ˆ
- ëŒ€ìƒ ì»´í¬ë„ŒíŠ¸: ${metadata.name}

Component Metadata (JSON):
${JSON.stringify(metadata, null, 2)}

Manual Structured Inputs (JSON):
${JSON.stringify(manualJson, null, 2)}

Manual Policy Notes (raw markdown):
${manualInputs.rawPolicy || "(ì •ë³´ ì—†ìŒ)"}

Instruction:
- ë‹¹ì‹ ì€ ë””ìì¸ ì‹œìŠ¤í…œ ë¬¸ì„œí™” ì „ë¬¸ê°€ì´ë©°, ë””ìì´ë„ˆê°€ ë°”ë¡œ í™œìš©í•  ìˆ˜ ìˆëŠ” ê°€ì´ë“œë¥¼ ì‘ì„±í•´ì•¼ í•œë‹¤.
- í•œêµ­ì–´ë¡œ ì‘ì„±í•˜ê³ , ìˆ˜ì§‘ëœ ë°ì´í„°ì™€ ì œê³µëœ ë©”ëª¨ì— ê¸°ë°˜í•œ ì‚¬ì‹¤ë§Œ ê¸°ìˆ í•œë‹¤. ì¶”ì¸¡ì´ë‚˜ ì„ì˜ê°’ì„ ì¶”ê°€í•˜ì§€ ì•ŠëŠ”ë‹¤.
- Manual Structured Inputsì˜ í•„ë“œë¥¼ ìš°ì„  í™œìš©í•˜ë˜ ë¹„ì–´ ìˆëŠ” ê°’ì€ Component Metadataì—ì„œ í™•ë³´ ê°€ëŠ¥í•œ ì •ë³´ë¡œ ë³´ì™„í•œë‹¤.
- Manual Policy NotesëŠ” ì„¹ì…˜ ì œëª©ì´ë‚˜ í‚¤ì›Œë“œë¥¼ ë¶„ì„í•´ ì ì ˆí•œ ì„¹ì…˜ì— ì¬êµ¬ì„±í•œë‹¤.
- ì œê³µëœ ì •ë³´ê°€ ì—†ê±°ë‚˜ ë¶ˆí™•ì‹¤í•˜ë©´ í•´ë‹¹ ì„¹ì…˜ì— "(ì •ë³´ ì—†ìŒ)"ì´ë¼ê³  ëª…ì‹œí•œë‹¤.
- í‘œ, ë¦¬ìŠ¤íŠ¸, ì½”ë“œ ë¸”ë¡ ë“± ë§ˆí¬ë‹¤ìš´ í¬ë§·ì€ ì•„ë˜ ë¸”ë£¨í”„ë¦°íŠ¸ë¥¼ ê·¸ëŒ€ë¡œ ë”°ë¥¸ë‹¤.
- Do's / Don'ts í˜•íƒœì˜ ì‚¬ìš© ê°€ì´ë“œë¥¼ í¬í•¨í•˜ê³ , ê°€ëŠ¥í•œ ê²½ìš° ì‹œê°ì  ì˜ˆì‹œ(í…ìŠ¤íŠ¸ ë‹¤ì´ì–´ê·¸ë¨)ë¥¼ ì œê³µí•œë‹¤.
- componentTypeì— ë”°ë¥¸ ì¶”ê°€ ê°€ì´ë“œëŠ” ë‹¤ìŒì„ ë”°ë¥¸ë‹¤:
${typeSpecificGuidance}

Section Inclusion Rules:
- í•˜ìœ„ ì»´í¬ë„ŒíŠ¸ ë°ì´í„°ê°€ ì—†ìœ¼ë©´ "## 7. í•˜ìœ„ ì»´í¬ë„ŒíŠ¸ & ì¡°í•©" ì„¹ì…˜ì— "(ì •ë³´ ì—†ìŒ)"ì´ë¼ê³  ì ëŠ”ë‹¤.
- ì¸í„°ë™ì…˜/ì• ë‹ˆë©”ì´ì…˜ ì •ë³´ê°€ ì—†ìœ¼ë©´ "## 8. ì¸í„°ë™ì…˜ & ì• ë‹ˆë©”ì´ì…˜"ì— "(ì •ë³´ ì—†ìŒ)"ìœ¼ë¡œ í‘œê¸°í•œë‹¤.
- ë°˜ì‘í˜• ì •ë³´ê°€ ì—†ìœ¼ë©´ "## 9. ë°˜ì‘í˜•"ì— "(ì •ë³´ ì—†ìŒ)"ìœ¼ë¡œ í‘œê¸°í•œë‹¤.
- ì ‘ê·¼ì„± ì •ë³´ê°€ ì—†ìœ¼ë©´ "## 10. ì ‘ê·¼ì„±"ì— "(ì •ë³´ ì—†ìŒ)"ìœ¼ë¡œ í‘œê¸°í•œë‹¤.

Output Blueprint:
# ğŸ§© ${metadata.name} ì»´í¬ë„ŒíŠ¸

## 1. ê°œìš”
- ëª©ì , ì‚¬ìš© ë§¥ë½, ì¹´í…Œê³ ë¦¬(componentType/complexity)ë¥¼ bulletë¡œ ì •ë¦¬í•œë‹¤.
- ì£¼ìš” í–‰ë™ì´ë‚˜ ì‚¬ìš©ì ê°€ì¹˜ í•œ ì¤„ ìš”ì•½ì„ í¬í•¨í•œë‹¤.

## 2. êµ¬ì¡° (Anatomy)
- ì»´í¬ë„ŒíŠ¸ ê³„ì¸µ êµ¬ì¡°ë¥¼ ì½”ë“œ ë¸”ë¡(\`\`\`) ë‹¤ì´ì–´ê·¸ë¨ìœ¼ë¡œ ì œì‹œí•œë‹¤.
- í•„ìˆ˜/ì„ íƒ íŒŒíŠ¸ë¥¼ êµ¬ë¶„í•˜ê³  ì—­í• ì„ ì„¤ëª…í•œë‹¤.

## 3. ë³€í˜• (Variants)
- í¬ê¸°/í…Œë§ˆ/ìƒíƒœ ë“± Variant ì¡°í•©ì„ í‘œë¡œ ì •ë¦¬í•œë‹¤. í—¤ë” ì˜ˆ: | Variant | ì„¤ëª… | ì‚¬ìš© ë§¥ë½ |

## 4. ìƒíƒœ (States)
- ìƒíƒœë³„ ì‹œê°/ë™ì‘ ë³€í™”ë¥¼ í‘œë¡œ ì •ë¦¬í•œë‹¤. í—¤ë” ì˜ˆ: | ìƒíƒœ | ë°°ê²½/í…Œë‘ë¦¬ | í…ìŠ¤íŠ¸ | ì•„ì´ì½˜ | ë©”ëª¨ |

## 5. íƒ€ì´í¬ê·¸ë˜í”¼ & ìƒ‰ìƒ
- textStyles, ìƒ‰ìƒ í† í°ì„ í‘œë¡œ ëª…ì‹œí•œë‹¤. í—¤ë” ì˜ˆ: | ìš”ì†Œ | í°íŠ¸ | í¬ê¸° | ë¼ì¸í•˜ì´íŠ¸ | ìƒ‰ìƒ í† í° |

## 6. ê°„ê²© & ë ˆì´ì•„ì›ƒ
- auto-layout ì„¤ì •, padding, spacing, alignmentë¥¼ ìˆ˜ì¹˜ì™€ í•¨ê»˜ bullet ë° í‘œë¡œ ì •ë¦¬í•œë‹¤.

## 7. í•˜ìœ„ ì»´í¬ë„ŒíŠ¸ & ì¡°í•©
- subcomponents ì—­í• , ì‚¬ìš© ì¡°ê±´ì„ bullet/í‘œë¡œ ì„¤ëª…í•œë‹¤. ì¡°í•© íŒ¨í„´ì´ ìˆìœ¼ë©´ ì˜ˆì‹œ ì¶”ê°€.

## 8. ì¸í„°ë™ì…˜ & ì• ë‹ˆë©”ì´ì…˜
- íŠ¸ë¦¬ê±°, ì• ë‹ˆë©”ì´ì…˜ ì‹œê°„/ì´ì§•, ì „í™˜ íë¦„ì„ í‘œë¡œ ì •ë¦¬í•œë‹¤. í—¤ë” ì˜ˆ: | íŠ¸ë¦¬ê±° | ê²°ê³¼ | ì‹œê°„ | Easing |

## 9. ë°˜ì‘í˜•
- ë¸Œë ˆì´í¬í¬ì¸íŠ¸, ì¤„ë°”ê¿ˆ ì‹œë‚˜ë¦¬ì˜¤, ë ˆì´ì•„ì›ƒ ë³€í™” ì˜ˆì‹œë¥¼ bulletê³¼ ì½”ë“œ ë¸”ë¡ìœ¼ë¡œ ì œê³µí•œë‹¤.

## 10. ì ‘ê·¼ì„±
- ARIA ì†ì„±, í‚¤ë³´ë“œ ë„¤ë¹„ê²Œì´ì…˜, í¬ì»¤ìŠ¤ ì²˜ë¦¬, ëŒ€ë¹„ ìš”êµ¬ì‚¬í•­ì„ bulletë¡œ ì •ë¦¬í•œë‹¤.

## 11. ì‚¬ìš© ê°€ì´ë“œ
- Do / Don't ë¦¬ìŠ¤íŠ¸ë¥¼ í‘œ ë˜ëŠ” bulletë¡œ ì œê³µí•˜ê³ , ì¶”ì²œ ì‹œë‚˜ë¦¬ì˜¤ë¥¼ í¬í•¨í•œë‹¤.

## 12. ì»¤ìŠ¤í…€ ì˜µì…˜ & ì œì•½
- styleOverrides ê°€ëŠ¥ í•­ëª©, ì œì•½ì‚¬í•­, ê´€ë ¨ ì»´í¬ë„ŒíŠ¸ë¥¼ í‘œë‚˜ bulletë¡œ ì •ë¦¬í•œë‹¤.`;
      }

      async function generateGuide() {
        if (!metadata) {
          setStatus("ë¨¼ì € ì»´í¬ë„ŒíŠ¸ë¥¼ ì„ íƒí•´ ì£¼ì„¸ìš”.", "error");
          return;
        }
        const apiKey = apiKeyInput.value.trim();
        if (!apiKey) {
          setStatus("OpenAI API Keyë¥¼ ì…ë ¥í•´ ì£¼ì„¸ìš”.", "error");
          return;
        }

        generateButton.disabled = true;
        copyButton.disabled = true;
        setStatus("AIê°€ ê°€ì´ë“œë¥¼ ìƒì„±í•˜ê³  ìˆìŠµë‹ˆë‹¤...");

        const manualInputs = collectManualInputs();
        const prompt = buildPrompt(metadata, manualInputs);

        try {
          const response = await fetch("https://api.openai.com/v1/chat/completions", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
              Authorization: `Bearer ${apiKey}`,
            },
            body: JSON.stringify({
              model: "gpt-4o-mini",
              messages: [
                {
                  role: "system",
                  content: "You are an assistant that writes Figma component documentation in Korean.",
                },
                { role: "user", content: prompt },
              ],
              temperature: 0.3,
            }),
          });

          if (!response.ok) {
            let detail = {};
            try {
              detail = await response.json();
            } catch (jsonError) {
              detail = {};
            }
            const message =
              detail && detail.error && detail.error.message
                ? detail.error.message
                : response.statusText;
            throw new Error(message);
          }

          const result = await response.json();
          let content = "(ì •ë³´ ì—†ìŒ)";
          if (
            result &&
            result.choices &&
            result.choices.length > 0 &&
            result.choices[0].message &&
            typeof result.choices[0].message.content === "string"
          ) {
            const trimmed = result.choices[0].message.content.trim();
            content = trimmed || "(ì •ë³´ ì—†ìŒ)";
          }

          guideOutput = content;
          activeTab = "guide";
          tabs.forEach((t) =>
            t.dataset.tab === "guide"
              ? t.classList.add("active")
              : t.classList.remove("active")
          );

          render();
          copyButton.disabled = !guideOutput;
          setStatus("ê°€ì´ë“œ ìƒì„±ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.", "success");
        } catch (error) {
          console.error(error);
          setStatus(`ìƒì„± ì‹¤íŒ¨: ${error.message}`, "error");
        } finally {
          generateButton.disabled = false;
        }
      }

      generateButton.addEventListener("click", generateGuide);

      onmessage = (event) => {
        const pluginMessage = event.data.pluginMessage || {};
        const type = pluginMessage.type;
        const payload = pluginMessage.payload || {};
        if (!type) return;

        if (type === "metadata") {
          if (payload.error) {
            metadata = null;
            guideOutput = "";
            render();
            updateHeader(null);
            setStatus(payload.error, "error");
            copyButton.disabled = true;
            return;
          }

          metadata = payload.data;
          guideOutput = "";
          copyButton.disabled = true;
          if (activeTab !== "data") {
            activeTab = "data";
            tabs.forEach((t) =>
              t.dataset.tab === "data"
                ? t.classList.add("active")
                : t.classList.remove("active")
            );
          }
          render();
          updateHeader(metadata);
          setStatus("ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì™”ìŠµë‹ˆë‹¤.");
          return;
        }

        if (type === "copy-result") {
          if (payload.success) {
            setStatus(payload.message || "ê°€ì´ë“œë¥¼ ë³µì‚¬í–ˆìŠµë‹ˆë‹¤.", "success");
          } else {
            setStatus(
              payload.message || "ë³µì‚¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ìˆ˜ë™ìœ¼ë¡œ ë³µì‚¬í•´ ì£¼ì„¸ìš”.",
              "error"
            );
          }
        }
      };

      parent.postMessage({ pluginMessage: { type: "request-metadata" } }, "*");
    </script>
  </body>
</html>
